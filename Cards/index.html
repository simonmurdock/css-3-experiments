
<html>
	<head>
		<link rel="stylesheet" href="css.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.2.0/knockout-min.js"></script>
		<title>3D card</title>
	</head>
<body>
<div id='container'>
	<div data-bind='foreach:cards'>
<!--<div class='card' data-bind="click:click,css:{pickedUp:pickedUp},style:{ left: x, top: y },attr: { style:'-webkit-transform:perspective(1000px) rotateY(-' + yVector() + 'deg) rotateX(-' + xVector() + 'deg);' }">-->
		<div class='card' data-bind="click:click,css:{pickedUp:pickedUp},style:{ left: x, top: y,zIndex:zIndex,backgroundImage:'url('+image+')' }">
		</div>
	</div>
</div>

<script>

	var g = null;

	function CardViewModel(parent,img) {

		var self = this;
		self.image = 'img/' + img + '.png';
		self.pickedUp = ko.observable(false);
		self.x = ko.observable(0);
		self.y = ko.observable(0);
		self.zIndex = ko.observable();

		self.click = function(){

			parent.zIndexCounter++;
			self.zIndex(parent.zIndexCounter);
			self.pickedUp(!self.pickedUp());

		}

		self.updatePosition = ko.computed(function(){

			var mx = parent.mouseX();
			var my = parent.mouseY();

			if(self.pickedUp()){
				self.x(mx-160);
				self.y(my-240);
			}
		});

	};

	function GameViewModel() {

		var self = this;

		self.cards = ko.observableArray([]);
		self.mouseX = ko.observable(0);
		self.mouseY = ko.observable(0);
		self.zIndexCounter = 0;

		self.init = function(){

			$("body").mousemove(function( e ) {
				self.mouseX(e.pageX);
				self.mouseY(e.pageY);
			});

		};

		self.init();

	};

	$(document).ready(function() {

		g = new GameViewModel();
		g.cards.push(new CardViewModel(g,'card'));
		g.cards.push(new CardViewModel(g,'card2'));
		g.cards.push(new CardViewModel(g,'card3'));
		ko.applyBindings(g);

	});

</script>
</body>
</html>