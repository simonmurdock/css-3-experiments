
<html>
<head>
  <link rel="stylesheet" href="css/css.css">
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/linear_partition.js"></script>
  <title>dynamic gallery</title>
</head>
<body>
  <div id='pageLayout'>
  	<div id='leftColumn'>Left Column shiz</div>
  	<div id='rightColumn'>
  		<div id='container'></div>
  	</div>
  </div>
<script>

function Photo() {
	height = 0,
	width = 0,
	aspect_ratio = 0,
	displayWidth = 0,
	displayHeight = 0
}

resize = function(photo, max_width, max_height,bufferLength) {

    var ratio = max_height / photo.height;

	photo.newScale = {
		width: (photo.width*ratio),
		height: max_height // set from row sum ars
	};
};

var photos, viewport_width, summed_width, rows, partition, index, row_buffer;

photos = [];
photos.push({name:16,width:297,height:226});
photos.push({name:17,width:374,height:245});
photos.push({name:18,width:512,height:512});
photos.push({name:19,width:441,height:286});
photos.push({name:21,width:277,height:186});
photos.push({name:23,width:297,height:123});
photos.push({name:24,width:182,height:323});
photos.push({name:25,width:312,height:153});
photos.push({name:27,width:297,height:226});
photos.push({name:28,width:374,height:245});
photos.push({name:29,width:512,height:512});
photos.push({name:30,width:441,height:286});
photos.push({name:32,width:277,height:186});
photos.push({name:34,width:297,height:123});

photos.push({name:1,width:181,height:323});
photos.push({name:2,width:312,height:153});
photos.push({name:3,width:1282,height:1660});
photos.push({name:4,width:297,height:226});
photos.push({name:5,width:374,height:245});
photos.push({name:6,width:512,height:512});
photos.push({name:8,width:441,height:286});
photos.push({name:9,width:1600,height:1067});
photos.push({name:10,width:277,height:186});
photos.push({name:11,width:1298,height:1678});
photos.push({name:12,width:1298,height:1678});


calculateFit = function(){

	document.getElementById("container").innerHTML = '';

	for (var i = 0; i < photos.length; i++) {
		photos[i].aspect_ratio = photos[i].width/photos[i].height;
	};

	var summed_width = 0;
	for (var i = 0; i < photos.length; i++) {
		summed_width += (photos[i].width);
	};

	viewport_width = ($('#rightColumn').width()-1); // minus one for rounding anomalies in firefox

	// dynamically adjust row count based on 'viewport' width
	rows = Math.round((summed_width/ viewport_width)/2);

	weights = [];
	row_buffer = [];
	overallIndex = 0;
	var galleryHtml = '';

	for (var z = 0; z < photos.length; z++) {
		weights.push(photos[z].aspect_ratio)
	};

	partition = linearPartition(weights, rows);

	for (var r = 0; r < partition.length; r++) {
		
		var row = partition[r];
		var summed_ars = 0;
		row_buffer = [];

		for (var i = 0; i < row.length; i++) {
			row_buffer.push(photos[overallIndex++]);
		};

		for (var z = 0; z < row_buffer.length; z++) {
			summed_ars += row_buffer[z].aspect_ratio;
		};

		for (var i = 0; i < row_buffer.length; i++) {
			var photo = row_buffer[i];
			
			//to prevent the 'bug' where a single column results in a larger height that expected it is because we are using a ratio like 1:2.
			resize(photo,viewport_width / summed_ars * photo.aspect_ratio, viewport_width / summed_ars,row_buffer.length);

			galleryHtml += '<div class="galleryPic" style="background-image:url(css/img/' + photo.name +'.png);width:'+photo.newScale.width+'px;height:'+photo.newScale.height+'px;" id="photo' + photo.name + '"></div>';
		}
	};

	document.getElementById("container").innerHTML = galleryHtml;
};

$( document ).ready(function() {
	calculateFit();

	window.onresize = function(event) {
		calculateFit();
	};

});

</script>
</body>
</html
