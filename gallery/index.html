
<html>
<head>
  <link rel="stylesheet" href="css/css.css">
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/linear_partition.js"></script>
  <script type="text/javascript" src="js/knockout-3.2.0.js"></script>
  <title>dynamic gallery</title>
</head>
<body>



  <div id='pageLayout'>
  	<div id='leftColumn'>Left Column shiz</div>
  	<div id='rightColumn'>
		<div id='container' data-bind="foreach: photos">
	   		<div class="galleryPic" data-bind="style:{ width:displayWidthCss(), height:displayHeightCss(), 'background-image':url() }">
	   		</div>
		</div>
  	</div>
  </div>
<script>

var vm;

function PhotoViewModel(name, width, height) {

	this.name = name;
	this.height = height;
	this.width = width;
	this.aspectRatio = width/height;
	this.displayWidth = ko.observable(100.0);
	this.displayHeight = ko.observable(100.0);
	this.displayWidthCss = ko.computed(function() {
		return this.displayWidth() + 'px';
	}, this);
	this.displayHeightCss = ko.computed(function() {
		return this.displayHeight() + 'px';
	}, this);
	this.url = function() { return 'url("css/img/' + name + '.png")'}

}

function galleryViewModel(photos) {

    var self = this;
    self.photos = photos;

	self.resize = function(photo, maxWidth, maxHeight) {

	    var ratio = maxHeight / photo.height;

	    photo.displayWidth(Math.floor(photo.width*ratio));
	    photo.displayHeight(Math.floor(maxHeight));
	}

	self.calculateFit = function(){

		var summedWidth = 0;
		for (var i = 0; i < self.photos.length; i++) {
			summedWidth += (self.photos[i].width);
		};

		viewportWidth = document.getElementById("container").clientWidth-1;

		// dynamically adjust row count based on 'viewport' width
		rows = Math.round((summedWidth/ viewportWidth)/2);

		weights = [];
		rowBuffer = [];
		overallIndex = 0;
		var galleryHtml = '';

		for (var z = 0; z < self.photos.length; z++) {
			weights.push(self.photos[z].aspectRatio)
		};

		partition = linearPartition(weights, rows);

		for (var r = 0; r < partition.length; r++) {
			
			var row = partition[r];
			var summedAspectRatios = 0;
			rowBuffer = [];

			for (var i = 0; i < row.length; i++) {
				rowBuffer.push(self.photos[overallIndex++]);
			};

			for (var z = 0; z < rowBuffer.length; z++) {
				summedAspectRatios += rowBuffer[z].aspectRatio;
			};

			for (var i = 0; i < rowBuffer.length; i++) {
				var photo = rowBuffer[i];
				
				//to prevent the 'bug' where a single column results in a larger height that expected it is because we are using a ratio like 1:2.
				self.resize(photo,viewportWidth / summedAspectRatios * photo.aspectRatio, viewportWidth / summedAspectRatios);
			}
		};
	}
}


	photos = new Array();
	/*
	photos.push(new Photo(16,297,226));
	photos.push(new Photo(17,374,245));
	photos.push(new Photo(18,512,512));
	photos.push(new Photo(19,441,286));
	photos.push(new Photo(21,277,186));
	photos.push(new Photo(23,297,123));
	photos.push(new Photo(24,182,323));
	photos.push(new Photo(25,312,153));
	photos.push(new Photo(27,297,226));
	photos.push(new Photo(28,374,245));
	photos.push(new Photo(29,512,512));
	photos.push(new Photo(30,441,286));
	photos.push(new Photo(32,277,186));
	photos.push(new Photo(34,297,123));*/
	photos.push(new PhotoViewModel(1,181,323));
	photos.push(new PhotoViewModel(2,312,153));
	photos.push(new PhotoViewModel(3,1282,1660));
	photos.push(new PhotoViewModel(4,297,226));
	photos.push(new PhotoViewModel(5,374,245));
	photos.push(new PhotoViewModel(6,512,512));
	photos.push(new PhotoViewModel(8,441,286));
	photos.push(new PhotoViewModel(9,1600,1067));
	photos.push(new PhotoViewModel(10,277,186));
	photos.push(new PhotoViewModel(11,1298,1678));
	photos.push(new PhotoViewModel(12,1298,1678));
	vm = new galleryViewModel(photos);
	vm.calculateFit();

$(document).ready(function() {





	ko.applyBindings(vm);

	window.onresize = function(event) {
		vm.calculateFit();
	};

});

</script>
</body>
</html
