
<html>
<head>
  <link rel="stylesheet" href="css/css.css">
  <script type="text/javascript" src="js/jquery.js"></script>
  <script type="text/javascript" src="js/linear_partition.js"></script>
  <title>dynamic gallery</title>
</head>
<body>
  <div id='pageLayout'>
  	<div id='leftColumn'>Left Column shiz</div>
  	<div id='rightColumn'>
  		<div id='container'></div>
  	</div>
  </div>
<script>

var g = {};

resize = function(photo, max_width, max_height) {
    var ratio = max_height / photo.height;
	photo.newScale = {
		width: (photo.width*ratio),
		height: max_height // set from row sum ars
	};
};

var photos, viewport_width, summed_width, rows, partition, index, row_buffer, devicePixelRatio;

photos = [];
photos.push({name:1,width:182,height:323});
photos.push({name:2,width:312,height:153});
photos.push({name:3,width:1282,height:1660});
photos.push({name:4,width:297,height:226});
photos.push({name:5,width:374,height:245});
photos.push({name:6,width:512,height:512});
photos.push({name:8,width:441,height:286});
photos.push({name:9,width:1600,height:1067});
photos.push({name:10,width:277,height:186});
photos.push({name:11,width:1298,height:1678});
photos.push({name:12,width:297,height:123});
photos.push({name:13,width:182,height:323});

calculateFit = function(){

	document.getElementById("container").innerHTML = '';

	for (var i = 0; i < photos.length; i++) {
		photos[i].aspect_ratio = photos[i].width/photos[i].height;
	};

	devicePixelRatio = window.devicePixelRatio;
	//ideal_height = parseInt($(window).height() / 2)

	var summed_width = 0;
	for (var i = 0; i < photos.length; i++) {
		summed_width += photos[i].width;
	};
	
	viewport_width = ($('#rightColumn').width()-1); // minus one for rounding issue

	// dynamically adjust row count based on 'viewport' width
	// remove summedwidth*devicepixel to shrink
	rows = Math.round(summed_width / (viewport_width * devicePixelRatio));

	weights = [];
	for (var z = 0; z < photos.length; z++) {
		weights.push(photos[z].aspect_ratio)
	};

	partition = linearPartition(weights, rows);
	index = 0;
	row_buffer = [];


	for (var r = 0; r < partition.length; r++) {
		
		var row = partition[r];

		$('#container').prepend('<div id="row'+r+'"></div>'); /* prepend to maintain clear div added */

		var summed_ars = 0;
		row_buffer = [];

		for (var i = 0; i < row.length; i++) {
			row_buffer.push(photos[index++]);
		};

		for (var z = 0; z < row_buffer.length; z++) {
			summed_ars += row_buffer[z].aspect_ratio;
		};

		for (var i = 0; i < row_buffer.length; i++) {
			var photo = row_buffer[i];
		
			resize(photo,viewport_width / summed_ars * photo.aspect_ratio, viewport_width / summed_ars);

			var rowDiv = '#container #row' + r;
			$(rowDiv).append('<div id="photo' + photo.name + '"></div>');
			$(rowDiv).addClass('galleryRow');

			var photoDiv = '#photo' + photo.name;
			$(photoDiv).addClass('galleryPic');

			$(photoDiv).css({
				width:photo.newScale.width,
				height:photo.newScale.height,
				backgroundImage:'url("css/img/' + photo.name +'.png")'
			});

			$(photoDiv).append('<div class="buttonBar">'+photo.width + 'x'+ photo.height+'</div>');
		}
	//});
	};

};

$( document ).ready(function() {
	calculateFit();
});

window.onresize = function(event) {
	calculateFit();
};

/*
$('body').mousemove(function(e) {
	$('#rightColumn').width(e.pageX-$('#container').position().left);
	calculateFit();
})
*/

</script>
</body>
</html
